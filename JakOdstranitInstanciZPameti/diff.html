<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en">
                         
  
<!-- Mirrored from www.py.cz/JakOdstranitInstanciZPameti/diff by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:02:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="Content-Type"
          content="text/html;charset=utf-8" />
    
    <link rel="stylesheet" type="text/css"
          href="../FrontPage/stylesheet.css" />
    <title>PyCZ: Programovací jazyk Python, aplikační servery a frameworky, atd. JakOdstranitInstanciZPameti</title>
    
    
    <meta name="robots" content="noindex,nofollow" />
  
  
  </head>
  <body>
    
    <div>
      <div id="pageheaderall" class="pageheader">
      <div id="accesskeys">
      <a accesskey="0"
         href="http://www.py.cz/JakOdstranitInstanciZPameti/helpaccesskeys"></a>
      <a accesskey="f" href="http://www.py.cz/FrontPage"></a>
      <a accesskey="c"
         href="http://www.py.cz/FrontPage/contents#JakOdstranitInstanciZPameti"></a>
      <a accesskey="r"
         href="http://www.py.cz/FrontPage/recentchanges"></a>
      <a accesskey="" href="http://www.py.cz/FrontPage"></a>
      
      <a accesskey="i"
         href="http://www.py.cz/FrontPage/wikiindex"></a>
      
      <a accesskey="o"
         href="http://www.py.cz/FrontPage/useroptions?redirectURL=http%3A//www.py.cz/JakOdstranitInstanciZPameti"></a>
      <a accesskey="h" href="http://www.py.cz/HelpPage"></a>
      
      
      <a accesskey="n" href="http://www.py.cz/NazevMetody"></a>
      <a accesskey="p"
         href="http://www.py.cz/InstanceTridDynamicky"></a>
      <a accesskey="u" href="http://www.py.cz/OOP"></a>
      <a accesskey="v"
         href="http://www.py.cz/JakOdstranitInstanciZPameti"></a>
      <a accesskey="m"
         href="http://www.py.cz/JakOdstranitInstanciZPameti/subscribeform"></a>
      <a accesskey="b"
         href="http://www.py.cz/JakOdstranitInstanciZPameti/backlinks"></a>
      <a accesskey="d"
         href="http://www.py.cz/JakOdstranitInstanciZPameti/diff"></a>
      <a accesskey="y"
         href="http://www.py.cz/JakOdstranitInstanciZPameti/history"></a>
      <a accesskey="e"
         href="http://www.py.cz/JakOdstranitInstanciZPameti/editform"></a>
      
    </div>
      <div id="navlinks" class="linkpanel">
      <table class="shade1" width="100%" border="0" cellspacing="0">
        <tr>
          <td align="right">
            
      <a href="http://www.py.cz/FrontPage"
         title="show front page">
      <span>home</span></a>
      <a href="http://www.py.cz/FrontPage/contents#JakOdstranitInstanciZPameti"
         title="show wiki contents">
      <span>contents</span></a>
      <a href="http://www.py.cz/FrontPage/recentchanges"
         title="show wiki recent changes">
      <span>changes</span></a>
      
      <a title="show wiki index"
         href="http://www.py.cz/FrontPage/wikiindex">
      <span>index</span></a>
      
      <a title="show wiki options"
         href="http://www.py.cz/FrontPage/useroptions?redirectURL=http%3A//www.py.cz/JakOdstranitInstanciZPameti">
      <span>options</span></a>
      <a title="show help page"
         href="http://www.py.cz/HelpPage">
      <span>help</span></a>
    
            
      
      <a href="http://www.py.cz/JakOdstranitInstanciZPameti/subscribeform"
         title="configure email subscription to this page or site">
        
      <span>subscribe</span></a>
      
      <a href="http://www.py.cz/JakOdstranitInstanciZPameti/editform"
         title="edit-page (last edited 6 years ago by geon)">
      <span>edit</span></a>
      
    
          </td>
        </tr>
      </table>
    </div>
      <div id="pageheader">
        <form method="GET"
              action="http://www.py.cz/FrontPage/searchwiki">
          <table width="100%" border="0" cellspacing="0">
            <tr>
              <!-- logo -->
              <td id="logo" width="1%" valign="top"
                  class="logo">
                
                  <a title="go to home page"
                     href="http://www.py.cz/FrontPage">
                    
                    <img src="http://www.py.cz/JakOdstranitInstanciZPameti/logo.jpg" border="0" alt="home" />
                    
                  </a>
                  &nbsp;
                
              </td>
              <!-- page name and context (parent topics) -->
              <td align="left" width="79%">
                
                  <small><ul class="outline expandable">
 <li><a href="http://www.py.cz/PythonRoot" name="PythonRoot">PythonRoot</a>
<ul class="outline expandable">
  <li><a href="http://www.py.cz/OOP" name="OOP">OOP</a>
<ul class="outline expandable">
  <li><h1 style="display:inline;"><a href="http://www.py.cz/JakOdstranitInstanciZPameti/backlinks" title="which pages link to this one ?" name="JakOdstranitInstanciZPameti">JakOdstranitInstanciZPameti</a></h1></li>
</ul>
  </li>
</ul>
 </li>
</ul>
</small>
                
                
              </td>
              <!-- search form & page info -->
              <td class="searchbox" width="20%" align="right">
                
                  <input id="searchinput" class="formfield"
                         name="expr" type="text" size="20"
                         maxlength="100" value=""
                         title="search all pages" /><br />
                  <span class="lasteditor">last edited  <a href="http://www.py.cz/JakOdstranitInstanciZPameti/history" title="show last edit" >6 years</a> ago by <b>geon</b></span><br>
                  <span class="creator">created 2009-07-08</span>   
                
                
              </td>
            </tr>
          </table>
        </form>
      </div>
      <div id="ratingform" align="right">  
      <!-- page rating form -->
      <div>
        <a name="ratingform"></a>
        <style type="text/css">
          input.rating {border:none;}
        </style>
        <form method="POST" id="ratingform"
              action="http://www.py.cz/JakOdstranitInstanciZPameti/vote">
           <input type="image" name="vote0" value="0"
                  alt="0" class="rating" width="14"
                  height="13"
                  src="http://www.py.cz/p_/sp"
                  style=""
                  title="click to vote 0 (poor) for this page (0 votes)" /><input
    type="image" name="vote1" value="1" alt="1"
    class="rating" src="http://www.py.cz/JakOdstranitInstanciZPameti/misc_/ZWiki/star_icon" style=""
    title="click to vote 1 (average) for this page (0 votes)" /><input
    type="image" name="vote2" value="2" alt="2"
    class="rating" src="http://www.py.cz/JakOdstranitInstanciZPameti/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 2 (above average) for this page (0 votes)" /><input
    type="image" name="vote3" value="3" alt="3"
    class="rating" src="http://www.py.cz/JakOdstranitInstanciZPameti/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 3 (good) for this page (0 votes)" /><input
    type="image" name="vote4" value="4" alt="4"
    class="rating" src="http://www.py.cz/JakOdstranitInstanciZPameti/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 4 (great) for this page (0 votes)" /><input
    type="image" name="vote5" value="5" alt="5"
    class="rating" src="http://www.py.cz/JakOdstranitInstanciZPameti/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 5 (superb) for this page (0 votes)" />
        </form>
      </div>
    </div>
    </div>
      <h1>Edit detail for JakOdstranitInstanciZPameti revision 1 of 1</h1>
      <div class="formcontent">
        <table border="0" cellspacing="0" width="100%">
          <tr valign="top">

            <td align="left">
              <form style="display:inline"
                    action="http://www.py.cz/JakOdstranitInstanciZPameti">
                <input type="submit" name="history:method"
                       value="Return to edit history" />
                
              </form>
            </td>

            <td align="center">
              <form style="display:inline"
                    action="http://www.py.cz/JakOdstranitInstanciZPameti/diff">
                <input type="hidden" name="rev" />
                
                <input disabled="1" value=" &lt; "
                       type="submit" accesskey="," />
              </form>
              <a style="font-weight:bold"
                 href="http://www.py.cz/JakOdstranitInstanciZPameti/diff?rev=1">1</a>
              <form style="display:inline"
                    action="http://www.py.cz/JakOdstranitInstanciZPameti/diff">
                <input type="hidden" name="rev" />
                
                <input disabled="1" value=" &gt; "
                       type="submit" accesskey="." />
              </form>
            </td>

            <td align="right">
              <form style="display:inline"
                    action="http://www.py.cz/JakOdstranitInstanciZPameti">
                <input type="hidden" name="rev" value="1" />
                <input value="Revert to this version"
                       type="submit" name="revert:method"
                       disabled="disabled" />
              </form>
            </td>

          </tr>
          <tr valign="top">
            <td colspan="3">
              <span>Editor:</span> geon
              <br />
              <span>Time:</span> 2009/07/08 18:37:58 GMT+2
            </td>
          </tr>
          <tr valign="top">
            <td colspan="3">
              <span>Note:</span> <span
    style="font-weight:bold; font-style:italic;"></span>
            </td>
          </tr>
        </table>
        <hr />
        <pre>
<b>changed:</b><span style="color:red;text-decoration:line-through">
-</span><span style="color:green">
Jak odstranit nepotřebnou instanci třídy z paměti
=======================================================

Dotaz z konference
---------------------
Pratele, potreboval bych poradit jak uvolnit pamet v pythonu, respektive jak
odstranit nepotrebnou instanci tridy z pameti. Zkousel jsem prikaz del. Po
provedeni &quot;del&quot; na instanci tridy je vsak pamet zaplnena furt stejne
(sledovano pomoci top v linuxu). Mozna na to jdu uplne spatne. Vi nekdo jak
provest uvolneni?

Odpověď
-----------

Po použití del se jen &quot;smaže&quot; proměnná a tím odstraní reference na
daný objekt. Objekt se uvolní až pokud na něj nejsou žádné reference
(ihned nebo až si toho všimne garbage collector, záleží na
implementaci a okolnostech). Ale dejme tomu, že se objekt skutečně
smaže, protože jste zavolal del na jedinou referenci. Pak se paměť
uvolní, jenže se jedná o paměť, kterou má python alokovanou právě pro
objekty, tedy se uvolní místo třeba pro nový objekt; paměť není
vrácena operačnímu systému (= žádná změna ve výpisu top), bylo by to
neefektivní vždy vracet každý kousek uvolněné paměti a pak zase
alokovat další (vlastně celý tenhle problém je o kompromisech mezi
výkonem a zabranou pamětí, i volání malloc/free je dost drahé).

Pokud se ale takto nastřádá hodně nevyužité paměti, interpreter se
může rozhodnout tuto paměť vrátit operačnímu systému. Ale záleží, jak
bylo tato paměť od operačního systému získána (pokud je použita funkce
malloc, záleží na implementaci v libc). Pokud se jedná o namapovanou
paměť (mmap) a celý blok paměti (přinejmenším celá stránka) je
nepotřebný, lze ho vrátit a hodnota v top se - konečně - sníží. Paměť
lze od operačního systému získat i jinými způsoby, to bych zde ale už
raději nerozváděl.

V důsledku toho se může stát, že při smazání velkého objektu se nemusí
uvolnit tolik paměti, kolik ten objekt zabíral. Pokud si s tím chcete
hrát, doporučuji strace  :-) 

To, co jsem teď napsal, je dost zjednodušené a zobecněné, napsal jsem
to bez konkrétní znalosti vnitřností Pythonu, které se navíc s vývojem
Pythonu a jeho interpreterů mění.![...] 

Mimochodem, nedávno se na Python mailing-listu ozval někdo s dotazem,
jestli nelze mít objekt naalokovaný řekněme dokud je volná paměť, že
by pak třeba sám zmizel. Nelze  :-)  Lze ale použít třeba memcache.

</span>
</pre>
        <hr />
        <div><h1 class="title">Jak odstranit nepotřebnou instanci třídy z paměti</h1>
<div class="section" id="dotaz-z-konference">
<h2>Dotaz z konference</h2>
<p>Pratele, potreboval bych poradit jak uvolnit pamet v pythonu, respektive jak
odstranit nepotrebnou instanci tridy z pameti. Zkousel jsem prikaz del. Po
provedeni &quot;del&quot; na instanci tridy je vsak pamet zaplnena furt stejne
(sledovano pomoci top v linuxu). Mozna na to jdu uplne spatne. Vi nekdo jak
provest uvolneni?</p>
</div>
<div class="section" id="odpoved">
<h2>Odpověď</h2>
<p>Po použití del se jen &quot;smaže&quot; proměnná a tím odstraní reference na
daný objekt. Objekt se uvolní až pokud na něj nejsou žádné reference
(ihned nebo až si toho všimne garbage collector, záleží na
implementaci a okolnostech). Ale dejme tomu, že se objekt skutečně
smaže, protože jste zavolal del na jedinou referenci. Pak se paměť
uvolní, jenže se jedná o paměť, kterou má python alokovanou právě pro
objekty, tedy se uvolní místo třeba pro nový objekt; paměť není
vrácena operačnímu systému (= žádná změna ve výpisu top), bylo by to
neefektivní vždy vracet každý kousek uvolněné paměti a pak zase
alokovat další (vlastně celý tenhle problém je o kompromisech mezi
výkonem a zabranou pamětí, i volání malloc/free je dost drahé).</p>
<p>Pokud se ale takto nastřádá hodně nevyužité paměti, interpreter se
může rozhodnout tuto paměť vrátit operačnímu systému. Ale záleží, jak
bylo tato paměť od operačního systému získána (pokud je použita funkce
malloc, záleží na implementaci v libc). Pokud se jedná o namapovanou
paměť (mmap) a celý blok paměti (přinejmenším celá stránka) je
nepotřebný, lze ho vrátit a hodnota v top se - konečně - sníží. Paměť
lze od operačního systému získat i jinými způsoby, to bych zde ale už
raději nerozváděl.</p>
<p>V důsledku toho se může stát, že při smazání velkého objektu se nemusí
uvolnit tolik paměti, kolik ten objekt zabíral. Pokud si s tím chcete
hrát, doporučuji strace  :-)</p>
<p>To, co jsem teď napsal, je dost zjednodušené a zobecněné, napsal jsem
to bez konkrétní znalosti vnitřností Pythonu, které se navíc s vývojem
Pythonu a jeho interpreterů mění.[...]</p>
<p>Mimochodem, nedávno se na Python mailing-listu ozval někdo s dotazem,
jestli nelze mít objekt naalokovaný řekněme dokud je volná paměť, že
by pak třeba sám zmizel. Nelze  :-)  Lze ale použít třeba memcache.</p>
<p>
</p>
</div>
</div>
      </div>
    </div>
    
  </body>

<!-- Mirrored from www.py.cz/JakOdstranitInstanciZPameti/diff by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:02:42 GMT -->
</html>

