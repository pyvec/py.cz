<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2009-July/009054.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:19:24 GMT -->
<HEAD>
   <TITLE> [python] sprava pameti,trida
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20sprava%20pameti%2Ctrida&In-Reply-To=%3C67c97cd90907080718g5b1c4b3agd6aa2b84a560b6f9%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2009-July/009057.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2009-July/009055.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[python] sprava pameti,trida</H1>
    <B>Petr Messner</B> 
    <A HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20sprava%20pameti%2Ctrida&In-Reply-To=%3C67c97cd90907080718g5b1c4b3agd6aa2b84a560b6f9%40mail.gmail.com%3E"
       TITLE="[python] sprava pameti,trida">petr.messner na gmail.com
       </A><BR>
    <I>Støeda Èervenec  8 16:18:42 CEST 2009</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2009-July/009057.html">[python] sprava pameti,trida
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2009-July/009055.html">[python] sprava pameti,trida
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2009-July/date.html#9054">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2009-July/thread.html#9054">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2009-July/subject.html#9054">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2009-July/author.html#9054">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/7/8 Petr Zlamal &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">p.zlamal na gmail.com</A>&gt;:
&gt;<i> Pratele,
</I>&gt;<i> Potreboval bych poradit jak uvolnit pamet v pythonu, respektive jak
</I>&gt;<i> odstranit nepotrebnou instanci tridy z pameti. Zkousel jsem prikaz del. Po
</I>&gt;<i> provedeni &quot;del&quot; na instanci tridy je vsak pamet zaplnena furt stejne
</I>&gt;<i> (sledovano pomoci top v linuxu). Mozna na to jdu uplne spatne. Vi nekdo jak
</I>&gt;<i> provest uvolneni?
</I>
Po pou¾ití del se jen &quot;sma¾e&quot; promìnná a tím odstraní reference na
daný objekt. Objekt se uvolní a¾ pokud na nìj nejsou ¾ádné reference
(ihned nebo a¾ si toho v¹imne garbage collector, zále¾í na
implementaci a okolnostech). Ale dejme tomu, ¾e se objekt skuteènì
sma¾e, proto¾e jste zavolal del na jedinou referenci. Pak se pamì»
uvolní, jen¾e se jedná o pamì», kterou má python alokovanou právì pro
objekty, tedy se uvolní místo tøeba pro nový objekt; pamì» není
vrácena operaènímu systému (= ¾ádná zmìna ve výpisu top), bylo by to
neefektivní v¾dy vracet ka¾dý kousek uvolnìné pamìti a pak zase
alokovat dal¹í (vlastnì celý tenhle problém je o kompromisech mezi
výkonem a zabranou pamìtí, i volání malloc/free je dost drahé).

Pokud se ale takto nastøádá hodnì nevyu¾ité pamìti, interpreter se
mù¾e rozhodnout tuto pamì» vrátit operaènímu systému. Ale zále¾í, jak
bylo tato pamì» od operaèního systému získána (pokud je pou¾ita funkce
malloc, zále¾í na implementaci v libc). Pokud se jedná o namapovanou
pamì» (mmap) a celý blok pamìti (pøinejmen¹ím celá stránka) je
nepotøebný, lze ho vrátit a hodnota v top se - koneènì - sní¾í. Pamì»
lze od operaèního systému získat i jinými zpùsoby, to bych zde ale u¾
radìji nerozvádìl.

V dùsledku toho se mù¾e stát, ¾e pøi smazání velkého objektu se nemusí
uvolnit tolik pamìti, kolik ten objekt zabíral. Pokud si s tím chcete
hrát, doporuèuji strace :-)

To, co jsem teï napsal, je dost zjednodu¹ené a zobecnìné, napsal jsem
to bez konkrétní znalosti vnitøností Pythonu, které se navíc s vývojem
Pythonu a jeho interpreterù mìní. Mo¾ná se pletu. V prùbìhu psaní této
odpovìdi Dan Pressl poslal odkaz na èlánek &quot;Python Memory Management&quot;,
tam je detailù více, tøeba ¾e pro rùzné typy objektù existují rùzné
alokátory a nìkteré z nich dokonce zabranou pamì» nevrací.

Mimochodem, nedávno se na Python mailing-listu ozval nìkdo s dotazem,
jestli nelze mít objekt naalokovaný øeknìme dokud je volná pamì», ¾e
by pak tøeba sám zmizel. Nelze :-) Lze ale pou¾ít tøeba memcache.

PM
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2009-July/009057.html">[python] sprava pameti,trida
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2009-July/009055.html">[python] sprava pameti,trida
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2009-July/date.html#9054">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2009-July/thread.html#9054">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2009-July/subject.html#9054">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2009-July/author.html#9054">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2009-July/009054.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:19:24 GMT -->
</html>
