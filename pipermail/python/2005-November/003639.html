<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2005-November/003639.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:26:19 GMT -->
<HEAD>
   <TITLE> [python] Vyøe¹eno
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=%5Bpython%5D%20%3D%3Futf-8%3Fb%3FVnnFmWXFoWVubw%3D%3D%3F%3D&In-Reply-To=436CE4A2.1030901%40seznam.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2005-November/003612.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2005-November/003645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[python] Vyøe¹eno</H1>
    <B>Petr Mach</B> 
    <A HREF="mailto:python%40py.cz?Subject=%5Bpython%5D%20%3D%3Futf-8%3Fb%3FVnnFmWXFoWVubw%3D%3D%3F%3D&In-Reply-To=436CE4A2.1030901%40seznam.cz"
       TITLE="[python] Vyøe¹eno">gsl na seznam.cz
       </A><BR>
    <I>Ètvrtek Listopad 10 08:02:27 CET 2005</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-November/003612.html">[python] monitrování paketù
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-November/003645.html">[python] Vyøe¹eno
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2005-November/date.html#3639">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-November/thread.html#3639">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-November/subject.html#3639">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-November/author.html#3639">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Petr Mach napsal(a):
&gt;<i> Potøebuji monitorovat v¹echny pakety, které pøicházejí a odcházejí z 
</I>&gt;<i> mého poèítaèe. Zkusil jsem:
</I>&gt;<i> 
</I>&gt;<i> s = socket.socket(socket.AF_INET, socket.SOCK_RAW, protocol)
</I>&gt;<i> 
</I>&gt;<i> Ale tohle bohu¾el vede jen k monitorování pøíchozích paketù. Mù¾e mì 
</I>&gt;<i> nìkdo nakopnout správným smìrem?
</I>
Tak¾e èíst v¹echny pøicházející IP pakety pøicházející dovnitø i 
odcházející ven je mo¾no pøes socket vytvoøený pøíkazem:

from socket import AF_PACKET, SOCK_DGRAM
from socket import socket, htons
ETH_P_ALL              = 0x003   # linux/if_ether.h

rawSock = socket(AF_PACKET, SOCK_DGRAM, htons(ETH_P_ALL))

Tento rawSocket se dá nabindovat na konkrétní sí»ové rozhraní pøíkazem:

rawSock.bind((&quot;ppp0&quot;, ETH_P_ALL))

Upozoròuji, ¾e se naèítají kompletní IP pakety, tj. paket obsahuje IP 
hlavièku a dal¹í data podle transportní vrstvy, tøeba TCP nebo UDP 
hlavièku. Pøijatý paket se dá zpracovat napø. takto (není to program, 
jen upravený výstøi¾ek z del¹ího programu):

from socket import inet_ntoa as ipN2A
from struct import pack, unpack

...

     dgram=rawSock.recv(2**16) # max. mozna delka paketu je 2^16

     # zpracovani ip hlavicky
     typ_lHead, lDgram, prot, ipSrc, ipDes = \
                           unpack(&quot;!BxH5xB2x4s4s&quot;, dgram[:20])
     typ   = typ_lHead&gt;&gt;4
     if  typ == 4: # zpracovani IPv4
         lHead = (typ_lHead&amp;15) * 4
         ipSrc = ipN2A(ipSrc)
         ipDes = ipN2A(ipDes)

         if  prot == 6: # tcp
             pSrc, pDes = unpack(&quot;!HH&quot;, dgram[lHead:lHead+4])
         else:
             pSrc = pDes = None

         # vypisuje delku paketu, zdrojovou a cilovou IP adresu
         # id protokolu a v pøípadì TCP protokolu i èísla portù
         print lDgram, ipSrc, ipDes, prot, pSrc, pDes


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-November/003612.html">[python] monitrování paketù
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-November/003645.html">[python] Vyøe¹eno
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2005-November/date.html#3639">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-November/thread.html#3639">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-November/subject.html#3639">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-November/author.html#3639">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2005-November/003639.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:26:19 GMT -->
</html>
