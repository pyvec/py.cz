<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2012-May/010681.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:17:31 GMT -->
<HEAD>
   <TITLE> [python] file.close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20file.close&In-Reply-To=%3C4FA13798.1070506%40seznam.cz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2012-May/010684.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2012-May/010682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[python] file.close</H1>
    <B>zu1234</B> 
    <A HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20file.close&In-Reply-To=%3C4FA13798.1070506%40seznam.cz%3E"
       TITLE="[python] file.close">zu1234 na seznam.cz
       </A><BR>
    <I>Støeda Kvìten  2 15:33:12 CEST 2012</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2012-May/010684.html">[python] Unicode/ne-unicode problem
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2012-May/010682.html">[python] file.close
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2012-May/date.html#10681">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2012-May/thread.html#10681">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2012-May/subject.html#10681">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2012-May/author.html#10681">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dìkuji za konstruktivní odpovìï.

1) Opravdu mi na jednom místì u close chybìly závorky :-)

2) Postup pomocí atexit jsem pou¾il podle zvyku z bash-e.
Ale python nezavírá soubory pøed atexit funkcí, jak jsem se mylnì domníval.

3) Pøepsal jsem to na 'with open(...) as ...'
	nebo 'try ... finally ...' pro zipfile.ZipFile

4) Knihovnu tempfile pou¾ívám, ale ta sama nic nema¾e. A právì pøi 
ru¹ení doèasného adresáøe jsem se dostal do problémù.

5) Nakonec jsem musel pøed ru¹ením doèasného adresáøe ponechat
time.sleep(1). Jinak nastávala chyba: adresáø není prázdný

Díky,
ZU

Dne 27.4.2012 16:51, Hynek Fabian napsal(a):
&gt;<i> IMO python sám pozavírá otevøené soubory kdy¾ garbage collector dìlá
</I>&gt;<i> úklid a zavolá destruktory osiøelým file instancím.
</I>&gt;<i> Se zámky ti neporadím, to je wydláètina :-) ale pokud chce¹ mít 100%
</I>&gt;<i> jistotu ¾e nic nezùstane, mù¾e¹ aplikovat &quot;NKVD algoritmus&quot; neboli
</I>&gt;<i> zavøít pro jistotu v¹echny bez rozdílu:
</I>&gt;<i>
</I>&gt;<i> for fd in range(0, os.sysconf_names.get(&quot;SC_OPEN_MAX&quot;, 1024)):
</I>&gt;<i>      try:
</I>&gt;<i>          os.close(fd)
</I>&gt;<i>      except OSError, ex:
</I>&gt;<i>          pass
</I>&gt;<i>
</I>&gt;<i> Ov¹em to bych pou¾il jen v krajním pøípadì, proto¾e pøijde¹ i o stdout.
</I>&gt;<i> V ka¾dém pøípadì bych se vyhnul hackùm jako je atexit,
</I>&gt;<i> uklidit po sobì mù¾e¹ u¾ v handleru výjimky, resp. ve finally bloku.
</I>&gt;<i> Pokud se chce¹ vyhnout opisování stále stejného bloku výjimky,
</I>&gt;<i> pou¾ij context manager. Jednoduchá varianta je ve file objektu u¾
</I>&gt;<i> zabudovaná:
</I>&gt;<i>
</I>&gt;<i> with open(&quot;spam&quot;, &quot;w&quot;) as f:
</I>&gt;<i>      f.write(&quot;ham&quot;)
</I>&gt;<i>      ...
</I>&gt;<i>
</I>&gt;<i> Zavøení je takto automatické, i kdy¾ vystøelí výjimka.
</I>&gt;<i> Napsat si vlastní kontext který soubor i sma¾e je trivka,
</I>&gt;<i> viz r.t.f.m. :-)
</I>&gt;<i>
</I>&gt;<i> btw na doèasné soubory máme krásnou knihovnu tempfile.
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2012-May/010684.html">[python] Unicode/ne-unicode problem
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2012-May/010682.html">[python] file.close
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2012-May/date.html#10681">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2012-May/thread.html#10681">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2012-May/subject.html#10681">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2012-May/author.html#10681">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2012-May/010681.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:17:31 GMT -->
</html>
