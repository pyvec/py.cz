<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2010-February/009385.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:19:04 GMT -->
<HEAD>
   <TITLE> [python] http form
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20http%20form&In-Reply-To=%3Ce5258fb31002090639r22fe602cr926668376ecb26f2%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2010-February/009384.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2010-February/009389.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[python] http form</H1>
    <B>Petr Hlávka</B> 
    <A HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20http%20form&In-Reply-To=%3Ce5258fb31002090639r22fe602cr926668376ecb26f2%40mail.gmail.com%3E"
       TITLE="[python] http form">petrhlavka na gmail.com
       </A><BR>
    <I>Úterý Únor  9 15:39:23 CET 2010</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-February/009384.html">[python] http form
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-February/009389.html">[python] Agregator (jenom pro Django)
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2010-February/date.html#9385">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-February/thread.html#9385">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-February/subject.html#9385">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-February/author.html#9385">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dobry den,

myslim, ze spatne je napr. radek

y = len('id=&quot;__EVENTVALIDATION&quot; value=&quot;')

__EVENTVALIDATION string se vam nenacita spravne (nicmene bude toho
asi vic, nejjednodussi bude odposlechnout, co presne posila prohlizec
a pak to zkusit nasimulovat v pythonu, myslim ze do postu davate
podstatne nim parametru a server vam pak neposle vysledek).

  S pozdravem Petr Hlavka.

2010/2/9 Szkandera.Karel &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">Szkandera.Karel na seznam.cz</A>&gt;:
&gt;<i> Myslím si ¾e to v poøádku mám a zobrazovat jsem si to taky zkou¹el, nicménì kontrolní printy jsem z kódu vymazal :) Kdybych si to stokrát nezkontroloval a nezkou¹el najít chybu sám, nepsal bych to sem. Máte nìjakou radu?
</I>&gt;<i>
</I>&gt;<i> K.
</I>&gt;<i>
</I>&gt;&gt;<i> Message: 19
</I>&gt;&gt;<i> Date: Tue, 9 Feb 2010 06:02:00 +0100
</I>&gt;&gt;<i> From: &quot;Jaroslav Lukesh&quot; &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">lukesh na seznam.cz</A>&gt;
</I>&gt;&gt;<i> To: &quot;Konference PyCZ&quot; &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">python na py.cz</A>&gt;
</I>&gt;&gt;<i> Subject: Re: [python] python http
</I>&gt;&gt;<i> Message-ID: &lt;1b5f01caa945$045ad660$<A HREF="http://www.py.cz/mailman/listinfo/python">6164a8c0 na xp</A>&gt;
</I>&gt;&gt;<i> Content-Type: text/plain; format=flowed; charset=&quot;iso-8859-2&quot;;
</I>&gt;&gt;<i>       reply-type=original
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> No a máte ty data a hlavièku skuteènì vpoøádku? Co¾ takhle si to pro
</I>&gt;&gt;<i> kontrolu zobrazit?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----- Original Message -----
</I>&gt;&gt;<i> From: &quot;Szkandera.Karel&quot; &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">Szkandera.Karel na seznam.cz</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Dìkuji za odpovìï, bohu¾el s tímto content-typem jsem to taky zkou¹el, ale
</I>&gt;&gt;<i> nefunguje to. Pøi tomto zadání mi to vrátí chybovou stránku serveru &quot; v
</I>&gt;&gt;<i> aplikaci nastali neoèekávaná chyba [callback/viewstate/mac]. Tento typ chyby
</I>&gt;&gt;<i> vzniká, pokud nesouhlasí kontrolní mechanizmy aplikace zaji¹»ující
</I>&gt;&gt;<i> konzistenci odeslaných a pøijatých interních aplikaèních dat na klienta a
</I>&gt;&gt;<i> zpìt (odeslaná data nesouhlasí s daty pøijatými). &quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Message: 2
</I>&gt;&gt;<i> &gt; Date: Sun, 07 Feb 2010 16:24:24 +0100
</I>&gt;&gt;<i> &gt; From: &quot;azurIt&quot; &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">azurit na pobox.sk</A>&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; len co som to zbezne pozrel, tak pri POST musi byt hlavicka Content-Type
</I>&gt;&gt;<i> &gt; nastavena na application/x-www-form-urlencoded
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; azur
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &gt;-----Pôvodná správa-----
</I>&gt;&gt;<i> &gt; &gt;Od: Szkandera.Karel [mailto:<A HREF="http://www.py.cz/mailman/listinfo/python">Szkandera.Karel na seznam.cz</A>]
</I>&gt;&gt;<i> &gt; &gt;Komu: <A HREF="http://www.py.cz/mailman/listinfo/python">python na py.cz</A>
</I>&gt;&gt;<i> &gt; &gt;Predmet: [python] python http
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;Ahoj,
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;chci posilat pomoci pythonu automaticky data do jednoho formulare na webu
</I>&gt;&gt;<i> &gt; &gt;a
</I>&gt;&gt;<i> &gt; nasledne odpoved zpracovat. Ikdyz bych rekl, ze by to melo jit, tak mi to
</I>&gt;&gt;<i> &gt; nevraci kyzeny vysledek. Chtel jsem, aby mi nasledujici skript vratil
</I>&gt;&gt;<i> &gt; stranku s
</I>&gt;&gt;<i> &gt; vyplnenym katastralnim uzemim a kam bych mohl nasledne zadat vyplnit
</I>&gt;&gt;<i> &gt; parcelni
</I>&gt;&gt;<i> &gt; cislo, ale vypada to, jakoby se ten POST nepovedl. Nevite v cem je chyba?
</I>&gt;&gt;<i> &gt; Dekuji
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;import httplib, urllib, urllib2, cookielib
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;#definice pouzivanych promennych
</I>&gt;&gt;<i> &gt; &gt;adresa = '<A HREF="http://m.nahlizenidokn.cuzk.cz/VyberParcelu.aspx">http://m.nahlizenidokn.cuzk.cz/VyberParcelu.aspx</A>'
</I>&gt;&gt;<i> &gt; &gt;cesta_k_vysledku='d:/python/cuzk/vysledek.html'
</I>&gt;&gt;<i> &gt; &gt;cislouzemi = '635561'
</I>&gt;&gt;<i> &gt; &gt;parcela = '1350'
</I>&gt;&gt;<i> &gt; &gt;headers = {'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US;
</I>&gt;&gt;<i> &gt; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2','Content-type':
</I>&gt;&gt;<i> &gt; 'application/xhtml+xml'}
</I>&gt;&gt;<i> &gt; &gt;text = ''
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;#poslani metodou get + ziskani vildacniho kodu
</I>&gt;&gt;<i> &gt; &gt;conn = httplib.HTTPConnection(&quot;m.nahlizenidokn.cuzk.cz&quot;)
</I>&gt;&gt;<i> &gt; &gt;odpoved = conn.request(&quot;GET&quot;, &quot;/VyberParcelu.aspx&quot;, headers=headers)
</I>&gt;&gt;<i> &gt; &gt;r1 = conn.getresponse()
</I>&gt;&gt;<i> &gt; &gt;odpoved = r1.read()
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;x = odpoved.find('__VIEWSTATE&quot; value=&quot;')
</I>&gt;&gt;<i> &gt; &gt;y = len('__VIEWSTATE&quot; value=&quot;')
</I>&gt;&gt;<i> &gt; &gt;z = odpoved.find('&quot; /&gt;',x+y)
</I>&gt;&gt;<i> &gt; &gt;state = odpoved[x+y:z]
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;x = odpoved.find('__EVENTVALIDATION&quot; value=&quot;')
</I>&gt;&gt;<i> &gt; &gt;y = len('id=&quot;__EVENTVALIDATION&quot; value=&quot;')
</I>&gt;&gt;<i> &gt; &gt;z = odpoved.find('&quot; /&gt;',x+y)
</I>&gt;&gt;<i> &gt; &gt;valid = odpoved[x+y:z]
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;#poslani metodou POST
</I>&gt;&gt;<i> &gt; &gt;params = urllib.urlencode({'__VIEWSTATE' : state, '__EVENTVALIDATION' :
</I>&gt;&gt;<i> &gt; &gt;valid
</I>&gt;&gt;<i> &gt; ,'ctl00$bodyPlaceHolder$vyberKU$btnKU' : 'Vyhledat' ,
</I>&gt;&gt;<i> &gt; 'ctl00$bodyPlaceHolder$vyberKU$txtKU' : cislouzemi})
</I>&gt;&gt;<i> &gt; &gt;headers = {'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US;
</I>&gt;&gt;<i> &gt; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2', 'Content-type':
</I>&gt;&gt;<i> &gt; 'application/xhtml+xml'}
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;conn.request(&quot;POST&quot;, &quot;/VyberParcelu.aspx&quot;, params, headers)
</I>&gt;&gt;<i> &gt; &gt;response = conn.getresponse()
</I>&gt;&gt;<i> &gt; &gt;print response.status, response.reason
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;#kontrolni vytisknuti odpovedi do souboru
</I>&gt;&gt;<i> &gt; &gt;data = response.read()
</I>&gt;&gt;<i> &gt; &gt;text=text + str(data)
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;pridat = file(cesta_k_vysledku,'w')
</I>&gt;&gt;<i> &gt; &gt;pridat.write(text)
</I>&gt;&gt;<i> &gt; &gt;pridat.close()
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Python mailing list
</I>&gt;<i> <A HREF="http://www.py.cz/mailman/listinfo/python">Python na py.cz</A>
</I>&gt;<i> <A HREF="http://www.py.cz/mailman/listinfo/python">http://www.py.cz/mailman/listinfo/python</A>
</I>&gt;<i>
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-February/009384.html">[python] http form
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-February/009389.html">[python] Agregator (jenom pro Django)
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2010-February/date.html#9385">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-February/thread.html#9385">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-February/subject.html#9385">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-February/author.html#9385">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2010-February/009385.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:19:04 GMT -->
</html>
