<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2007-August/006356.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:22:27 GMT -->
<HEAD>
   <TITLE> [python] Kriticka sekce (bylo RE: zamykani jednoho vlakna druhym)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=%5Bpython%5D%20Kriticka%20sekce%20%28bylo%20RE%3A%20zamykani%20jednoho%20vlakna%20druhym%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2007-August/006352.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2007-August/006358.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[python] Kriticka sekce (bylo RE: zamykani jednoho vlakna druhym)</H1>
    <B>Petr Prikryl</B> 
    <A HREF="mailto:python%40py.cz?Subject=%5Bpython%5D%20Kriticka%20sekce%20%28bylo%20RE%3A%20zamykani%20jednoho%20vlakna%20druhym%29&In-Reply-To="
       TITLE="[python] Kriticka sekce (bylo RE: zamykani jednoho vlakna druhym)">PrikrylP na skil.cz
       </A><BR>
    <I>Ètvrtek Srpen 16 09:31:44 CEST 2007</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2007-August/006352.html">[python] vyu¾ití warnings v mysqldb
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2007-August/006358.html">[python] 100
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2007-August/date.html#6356">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2007-August/thread.html#6356">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2007-August/subject.html#6356">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2007-August/author.html#6356">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jen to trochu okomentuju...

Marek se ptal
&gt;<i> caute mam maly problem mam dve vlakna urobene cez 
</I>&gt;<i> threading  a potrebujem jedno vlakno uzamknut 
</I>&gt;<i> na chvilku druhym da sa to nejako?
</I>
Jirka se sna¾il (neberte mu to, vìt¹ina se na to vy...)
&gt;<i> Nevim co znamena &quot;uzamknout&quot; a nikdy jsem neresil 
</I>&gt;<i> podobny problem, ale vzhledem k tomu ze vlakna 
</I>&gt;<i> sdileji globalni promenne by nemel byt problem 
</I>&gt;<i> v jednom vlakne nastavit:
</I>&gt;<i>
</I>&gt;<i> vlakna_mutex = True
</I>&gt;<i>
</I>&gt;<i> a v druhem na vhodnem miste:
</I>&gt;<i>
</I>&gt;<i> while vlakna_mutex is True:
</I>&gt;<i>    sleep(1)
</I>&gt;<i>
</I>&gt;<i> Tohle by bylo &quot;brutalni reseni&quot; ktere bych 
</I>&gt;<i> zkusil jako prvni.
</I>
Karol zareagoval (má pravdu)
&gt;<i> takyto postup nemozno nazvat riesenie, ale hnusna &quot;praktika&quot; =&gt;
</I>&gt;<i> nespolahlive, nebezpecne, nepredvidatelne vysledky ... 
</I>&gt;<i> Odporucam pozriet dokumentaciu [1] a clanok [2],
</I>&gt;<i> pre lenivych:
</I>
Jirka si sype popel...
&gt;<i> Nojo, ja jsem si rikal ze nemam odpovidat na dotaz 
</I>&gt;<i> kdyz si nejsem jisty odpovedi (a nemam cas 
</I>&gt;<i> to hledat). Mea culpa, omlouvam se. 
</I>
Teï ten komentáø. Thready jsou (pseudo)paralelnì bì¾ící
èinnosti, které sdílejí spoleèný datový prostor. Od 
èistých procesù se li¹í právì tím sdílením pamìti.

Paralelnì bì¾ící èisté procesy se musí chovat 
korektnì vùèi pou¾ívaným prostøedkùm. Platí to i 
pro thready, které se navíc musí starat právì
o to sdílení pamìti. Pamì» je místem, o které
musí korektnì soupeøit. Tak¾e multithreading
mù¾e být z hlediska programátorského výhodný
v ménì pøípadech, ne¾ se na první pohled mù¾e zdát.
Pokud se mu dá vyhnout, je lep¹í se mu vyhnout.
Pokud se mu nedá vyhnout, je dobré vìdìt, ¾e
korektní øe¹ení mohou být obtí¾ná.

Pøi sdílení prostøedku je nutné zajistit
výluèný pøístup. K pou¾ívání prostøedku dochází
v úseku kódu, kterému se øíká kritická sekce.
Kritická je proto, proto¾e pokud by se více
procesù dostalo souèasnì do odpovídající kritické
sekce, nastala by &quot;kritická situace&quot;. Mohou nastat
v zásadì dva typy havárií deadlock (smrtelné
objetí -- v¹ichni jsou mrtví) a race (vyhladovìní
-- jeden se furt nemù¾e dostat k lizu, i kdy¾
nìco furt jede).

Obvykle uva¾ujeme tak, ¾e v¹echny paralelnì 
bì¾ící procesy mají stejné postavení. Musí se tedy
pou¾ít nástroj, který jim umo¾ní dohodu.
Pøíslu¹ná operace, pomocí které se rozhodnutí
o vstupu do kritické sekce realizuje, musí být
atomická (nedìlitelná, nepøeru¹itelná). Proto
k tomu nelze vyu¾ít prostøedkù o které soupeøíme.
Proto nelze k rozhodnutí o pou¾ití sdílené
pamìti vyu¾ít jen obyèejné pøíkazy a kousek
sdílené pamìti.

Dynamické èekání (v cyklu) je v¾dycky na prd, 
proto¾e zatì¾uje procesor. Proces se musí nechat
uspat (zablokovat) na dobu, kdy nemù¾e pracovat.
Z pohledu procesu je to ale aktivita typu 
&quot;Pøed chvílí jsem usnul, ale právì jsem se 
vzbudil a jedu dál. Ani nevím, jak dlouho
jsem spal. Byl to jen okam¾íèek... (?)&quot;

Pokud bych chtìl k vzájemnému vylouèení
procesù pou¾it obyèejné pøíkazy a obyèejnou
sdílenou promìnnou, nedosáhnu atomického
chování:

    # Chybný pokus o realizaci kritické sekce.
    while blokováno:     # (1)
        pass
 
    blokováno = True     # (2)

    # Tohle je kód kritické sekce.
    pøíkaz1
    pøíkaz2
    ...

    # Tady jako opustím kritickou sekci.
    blokováno = False    # (3)

Jen¾e... Dejme tomu, ¾e budu mít 3 thready
provádìjící uvedený kód. Jeden s nich 
se právì nachází v na¹í &quot;kritické sekci.
Dejme tomu, ¾e ostatní dva do ní právì chtìjí
vstoupit. Trèí dynamicky v cyklu (1).

A¾ dosud to mù¾e být zdánlivì vpoøádku.
Kdy¾ ale ten jeden opustí pøíkazem (3)
kritickou sekci, mù¾e dojít k tomu, ¾e 
se ostatní thready prostøídají v èinnosti
tak, ¾e oba propadnou pøes cyklus (1)
a teprve pak se dostanou k provádìní (2).
Je to právì tím, ¾e (1) a (2) se neprovedou 
atomicky, najednou, neoddìlitelnì.
Oba thready tedy vlezou do kritické sekce,
a myslí si, ¾e v ní není nikdo jiný, co¾ je
chyba.

Zjednodu¹enì øeèeno, je to stejné, jako
kdybychom se nezatì¾ovali podobnými klièkami
a psali to úplnì tupì. Jen se sní¾í pravdìpodobnost
toho, ¾e ta situace nastane, ale tím se souèasnì
zvý¹í obtí¾nost odhalování pøíèin problémù, 
které se v budoucnu vyskytnou. Jinými slovy, 
problém nebudeme hledat v tomto místì, proto¾e
si myslíme, ¾e jsme to o¹etøili a &quot;musí&quot; 
to fungovat.

pepr

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2007-August/006352.html">[python] vyu¾ití warnings v mysqldb
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2007-August/006358.html">[python] 100
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2007-August/date.html#6356">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2007-August/thread.html#6356">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2007-August/subject.html#6356">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2007-August/author.html#6356">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2007-August/006356.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:22:27 GMT -->
</html>
