<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2005-March/002345.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:27:44 GMT -->
<HEAD>
   <TITLE> RE: [python] Dynamické vytvoøení instance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=%3D%3Fiso-8859-2%3FQ%3FRE%3D3A_%3D5Bpython%3D5D_Dynamick%3DE9_vytvo%3DF8en%3DED_instance%3F%3D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2005-March/002343.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2005-March/002346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>RE: [python] Dynamické vytvoøení instance</H1>
    <B>Petr Prikryl</B> 
    <A HREF="mailto:python%40py.cz?Subject=%3D%3Fiso-8859-2%3FQ%3FRE%3D3A_%3D5Bpython%3D5D_Dynamick%3DE9_vytvo%3DF8en%3DED_instance%3F%3D&In-Reply-To="
       TITLE="RE: [python] Dynamické vytvoøení instance">Prikryl na skil.cz
       </A><BR>
    <I>Ètvrtek Bøezen  3 09:01:02 CET 2005</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-March/002343.html">[python] Otázka - funkcia os.system
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-March/002346.html">[python] Otázka - funkcia os.system
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2005-March/date.html#2345">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-March/thread.html#2345">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-March/subject.html#2345">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-March/author.html#2345">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Jsem zaèáteèník, sna¾il jsem se 
</I>&gt;<i> vytvoøit funkci, která by 
</I>&gt;<i> dynamicky vytváøela
</I>&gt;<i> instance tøídy :( 
</I>
V Pythonu se instance objektù v¾dy vytváøejí
dynamicky. Pøi pou¾ití exec se jde o kousek
dál -- dynamicky se kompiluje kód, který
jsem zkonstruoval jako øetìzec. Asi to nelze
pova¾ovat za zaèáteènickou problematiku.
Jinými slovy, exec potøebuji a¾ v situacích,
které nejsou typické a nedají se øe¹it
jednodu¹eji (viz ukázkový kód na konci):

&gt;<i> class trida:
</I>&gt;<i>     pass;
</I>
... støedník je tady zbyteèný ;)

&gt;<i> 
</I>&gt;<i> def new_objekt(x):
</I>&gt;<i>     exec &quot;obj&quot;+str(x)+&quot;= trida&quot;
</I>
Tady chybí za identifikátorem tøídy závorky.
V takovém pøípadì se nevytváøí instance,
ale jen reference na definici tøídy.
(Pou¾ití identifikátoru objX se pak chová
naprosto stejnì jako identifikátor tøída).

Pro tøídy se doporuèuje volit identifikátor
s velkým poèáteèním písmenem.

&gt;<i>     exec &quot;global obj&quot;+str(x)
</I>
Tady je problém. Direktiva global se 
musí uvést pøedem. Nepamatuji si, kdy
jsem ji naposledy pou¾il. Pokud ano,
v¾dy to bylo v situaci, kdy globální
promìnná tohoto jména u¾ existovala.
Pokud se domnívám správnì, pak objX 
u¾ musí v globálním prostoru existovat.
Pak se bude pøi pøístupu k promìnné 
uvedeného jména uvnitø funkce pøistupovat
ke globální promìnné a ne k lokální 
promìnné stejného jména uvnitø funkce.

V souvislosti s exec je tu ale je¹tì jiný
zádrhel, který uvedené pokusy staví
na úroveò &quot;vyfukování tabákového
kouøe do umyvadla s vodou&quot;. Dokumentace
øíká (6.13 The global statement):

  Programmer's note: the global is a directive 
  to the parser. It applies only to code parsed 
  at the same time as the global statement.
  In particular, a global statement contained 
  in an exec statement does not affect 
  the code block containing the exec statement, 
  and code contained in an exec statement 
  is unaffected by global statements in the code 
  containing the exec statement. The same applies 
  to the eval(), execfile() and compile() functions.

&gt;<i> new_objekt(1)       
</I>&gt;<i> print obj1
</I>&gt;<i> 
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>   File &quot;C:/narozeniny/j.py&quot;, line 14, in ?
</I>&gt;<i>     print obj1
</I>&gt;<i> NameError: name 'obj1' is not defined
</I>
Vý¹e uvedená poznámka z dokumentace znamená,
¾e za pou¾ití global nejsem schopný procpat
zkonstruované jméno zevnitø exec
mezi globální promìnné. Mù¾u to ale udìlat
jinak. 

Instanci objektu nemusím vytváøet souèasnì
s jejím jménem, proto¾e jméno je nevýznamné
(zpøístupòuje referenci na objekt). Instanci
tøídy mù¾u vytvoøit klasicky a ménì klasickým
zpùsobem pouze svá¾u referenci na takto 
vytvoøený objekt s novì vytvoøeným globálním 
jménem (viz následující pøíklad). Osobnì bych 
ale dal pøednost nìjakému ménì krkolomnému 
øe¹ení.

j.py
==========================================
class Trida:
    def __str__(self):
        &quot;&quot;&quot;Retezcova reprezentace objektu -- vyuzije ji print&quot;&quot;&quot;
        return 'jsem Trida'


def new_object(x):
    # Takhle to jde vytvorit a zde zpristupnit, ale
    # v globalnim prostoru to neuvidim.
    exec 'obj' + x + '= Trida()'
    print 'funkce new_object() vytvorila obj' + x
    exec 'print obj' + x

    # Alternativa bez direktivy global, ale s vyuzitim
    # zabudovane funkce globals(), ktera vraci slovnik
    # globalni urovne.
    identifikator = 'obj' + x + x      # zkonstruovane jmeno
    globals()[identifikator] = Trida()
    print 'funkce new_object() vytvorila obj' + x + x
    exec 'print obj' + x + x


print 'Nejjednodussi...'
obj1 = Trida()
print obj1


print 'Pres funkci s vedlejsim efektem -- krkolomne...'
new_object('A')
print 'Objekt vytvoreny funkci:', objAA


print '\nVice objektu do seznamu.'
lst = []
for i in xrange(10):
    lst.append(Trida())

for tt in lst:
   print tt


print '\nVice objektu do slovniku.'
d = {}
for i in xrange(10):
    d['obj%d' % i] = Trida()

for tt in d:
   print d[tt]


print '\nVice objektu pres exec (asi se pouziva velmi zrika)'
for i in xrange(10):
    prikaz = 'obj%d = Trida()' % i
    exec prikaz

print dir()
print obj0
print obj1
print obj2
print obj3
print obj4
print obj5
print obj6
print obj7
print obj8
print obj9

print '-' * 70
==========================================

A je¹tì nakonec... Vyu¾ití funkce pro vytváøení
instancí má smysl pouze tehdy, kdy¾ funkce na
základì dal¹ích okolností rozhodne, jaká instance
(jaké tøídy nebo s jakým vnitøním stavem). Pak
se tomu øíká &quot;class factory&quot;. V tomto pøípadì
se funkce pou¾ije èistým zpùsobem (nevolá se s cílem
vyu¾ít vedlej¹í efekt, ale vracenou hodnotu).
Pou¾ití by vypadalo nìjak takto:


==========================================
class Trida1: 
    def __str__(self):
        return 'instance tridy Trida1'

class Trida2: 
    def __str__(self):
        return 'instance tridy Trida2'


def mojeClassFactory(okolnosti):
   if okolnosti == 7:
       return Trida1()
   elif okolnosti == 8:
       return Trida2()
   else:
       return None


objA = mojeClassFactory(7)
print 'objA:', objA

objB = mojeClassFactory(8)
print 'objB:', objB

objC = mojeClassFactory(1)
print 'objC:', objC
==========================================

(Okolnosti mohou samozøejmì nabývat rùznou podobu.)

Petr

-- 
Petr Prikryl (prikrylp at skil dot cz) 

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-March/002343.html">[python] Otázka - funkcia os.system
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2005-March/002346.html">[python] Otázka - funkcia os.system
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2005-March/date.html#2345">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-March/thread.html#2345">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-March/subject.html#2345">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2005-March/author.html#2345">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2005-March/002345.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:27:44 GMT -->
</html>
