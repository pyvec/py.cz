<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 
<!-- Mirrored from www.py.cz/pipermail/python/2010-October/009991.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:18:22 GMT -->
<HEAD>
   <TITLE> [python] Stopky
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20Stopky&In-Reply-To=%3CAANLkTinDqFuO8hvB4Tsy6UJLuAqwjkzH89nDDUfgkY1h%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <LINK REL="Previous"  HREF="http://www.py.cz/pipermail/python/2010-October/009988.html">
   <LINK REL="Next"  HREF="http://www.py.cz/pipermail/python/2010-October/009992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[python] Stopky</H1>
    <B>Petr Messner</B> 
    <A HREF="mailto:python%40py.cz?Subject=Re%3A%20%5Bpython%5D%20Stopky&In-Reply-To=%3CAANLkTinDqFuO8hvB4Tsy6UJLuAqwjkzH89nDDUfgkY1h%40mail.gmail.com%3E"
       TITLE="[python] Stopky">petr.messner na gmail.com
       </A><BR>
    <I>Pátek Øíjen 22 16:47:56 CEST 2010</I>
    <P><UL>
        <LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-October/009988.html">[python] Stopky
</A></li>
        <LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-October/009992.html">[python] Stopky
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2010-October/date.html#9991">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-October/thread.html#9991">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-October/subject.html#9991">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-October/author.html#9991">[ autora ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ahoj,

pokud chce¹ èekání na vstup omezit nìjakým èasovým intervalem, má¹
nìkolik mo¾ností:

1) nastavit si alarm(), operaèní systém (funguje to na unixech) ti po
uplynutí zadané doby po¹le SIGALRM, který nìjak patøiènì o¹etøí¹,

2) spustit dal¹í vlákno, to na danou dobu uspat (time.sleep()), které
po probuzení pøípadnì pøeru¹í to první vlákno; toto by bylo nejlep¹í
øe¹ení, proto¾e by fungovalo i ve Windows - Python ov¹em pokud vím (a
co jsem byl schopen dohledat) neumo¾òuje pøeru¹it vlákno a mo¾ná ani
pøeru¹it syscall, na kterém dané vlákno zrovna &quot;stojí&quot; (dá se to
trochu obejít pomocí signal handlerù nebo hackù pøes ctypes a C API,
to u¾ je ale lep¹í øe¹ení 1)),

3) pou¾ít neblokující ètení; to bys pak volal stále dokola, dokud by
neuplynulo tìch 5 minut (to není moc dobré, ale asi nejjednodu¹¹í na
implementaci; opìt zøejmì jen pro unix),

4) pou¾ít nìco jiného, nejspí¹ dost exotického, tøeba pokud tvùj
operaèní systém pøímo nabízí nìjaké asynchronní I/O,

4.5) ve Windows: msvcrt
(<A HREF="http://docs.python.org/library/msvcrt.html#console-i-o">http://docs.python.org/library/msvcrt.html#console-i-o</A>),

ale nejelegantnìj¹í bude

5) pou¾ít select nebo pollování (poll, epoll atd.), v tomto pøípadì
bohatì staèí select. Je to funkce, které dá¹ jako parametry file
deskriptory (pøípadnì v Pythonu file objekty) a volitelným parametrem
je èas, po který bude select èekat. Funkce se pøeru¹í v pøípadì, ¾e
uplyne daný timeout, nebo ¾e se na daném vstupu objeví nìjaká data. Je
to ¹iroce pou¾ívaná technika - od právì èekání na vstup od u¾ivatele
a¾ po výkonné sí»ové servery. Je tu akorát problém s Windows a
OpenVMS, kde select funguje jen na socketech. Mo¾ná ale pùjde
vygooglit, jak to obejít, pøípadnì pro Windows pou¾ít vý¹e zmínìné
msvcrt.

Viz tedy pydoc select a také man select_tut. Zkusím uvést nìjaký ukázkový kód:

#!/usr/bin/env python

import fcntl
import os
import select
import sys

timeout = 300  # 5 minut

# make stdin a non-blocking file
fl = fcntl.fcntl(sys.stdin.fileno(), fcntl.F_GETFL)
fcntl.fcntl(sys.stdin.fileno(), fcntl.F_SETFL, fl | os.O_NONBLOCK)

while True:
   (rlist, wlist, xlist) = select.select([sys.stdin], [], [], timeout)
   print rlist
   if rlist:
       print &quot;Bylo zadano: %r&quot; % sys.stdin.read()
   else:
       print &quot;Cas vyprsel&quot;
       break

Snad jsem odpovìdìl, na co jsi se ptal.


Petr Messner

2010/10/22 remixus79 &lt;<A HREF="http://www.py.cz/mailman/listinfo/python">remixus79 na gmail.com</A>&gt;:
&gt;<i> Zdravím,
</I>&gt;<i>
</I>&gt;<i> potreboval by som poradi». Mám program v ktorom je nekoneèný cyklus.
</I>&gt;<i> Tento cyklus stale caka na vstup od uzivatela. Potreboval by som to
</I>&gt;<i> spravi» tak ¾e by stále èakal na ten vstup ale zároveò by aj
</I>&gt;<i> kontroloval èas a ak by u¾ívateµ niè nezadal po 5minútach by sa
</I>&gt;<i> vypol.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ïakujem za ka¾dú radu.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Python mailing list
</I>&gt;<i> <A HREF="http://www.py.cz/mailman/listinfo/python">Python na py.cz</A>
</I>&gt;<i> <A HREF="http://www.py.cz/mailman/listinfo/python">http://www.py.cz/mailman/listinfo/python</A>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Pøedchozí pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-October/009988.html">[python] Stopky
</A></li>
	<LI>Následující pøíspìvek: <A HREF="http://www.py.cz/pipermail/python/2010-October/009992.html">[python] Stopky
</A></li>
         <LI> <B>Zprávy tøídìné podle:</B> 
              <a href="http://www.py.cz/pipermail/python/2010-October/date.html#9991">[ data ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-October/thread.html#9991">[ vlákna ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-October/subject.html#9991">[ subjektu ]</a>
              <a href="http://www.py.cz/pipermail/python/2010-October/author.html#9991">[ autora ]</a>
         </LI>
       </UL>
<hr>
<a href="http://www.py.cz/mailman/listinfo/python">Dal¹í informace o konferenci Python</a><br>
</body>
<!-- Mirrored from www.py.cz/pipermail/python/2010-October/009991.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:18:22 GMT -->
</html>
