<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en">
                         
  
<!-- Mirrored from www.py.cz/Shelve/diff by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:15:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="Content-Type"
          content="text/html;charset=utf-8" />
    
    <link rel="stylesheet" type="text/css"
          href="../FrontPage/stylesheet.css" />
    <title>PyCZ: Programovací jazyk Python, aplikační servery a frameworky, atd. Shelve</title>
    
    
    <meta name="robots" content="noindex,nofollow" />
  
  
  </head>
  <body>
    
    <div>
      <div id="pageheaderall" class="pageheader">
      <div id="accesskeys">
      <a accesskey="0"
         href="http://www.py.cz/Shelve/helpaccesskeys"></a>
      <a accesskey="f" href="http://www.py.cz/FrontPage"></a>
      <a accesskey="c"
         href="http://www.py.cz/FrontPage/contents#Shelve"></a>
      <a accesskey="r"
         href="http://www.py.cz/FrontPage/recentchanges"></a>
      <a accesskey="" href="http://www.py.cz/FrontPage"></a>
      
      <a accesskey="i"
         href="http://www.py.cz/FrontPage/wikiindex"></a>
      
      <a accesskey="o"
         href="http://www.py.cz/FrontPage/useroptions?redirectURL=http%3A//www.py.cz/Shelve"></a>
      <a accesskey="h" href="http://www.py.cz/HelpPage"></a>
      
      
      <a accesskey="n" href="http://www.py.cz/Atexit"></a>
      <a accesskey="p"
         href="http://www.py.cz/VytvoreniWwwSlovnik"></a>
      <a accesskey="u" href="http://www.py.cz/FrontPage"></a>
      <a accesskey="v" href="http://www.py.cz/Shelve"></a>
      <a accesskey="m"
         href="http://www.py.cz/Shelve/subscribeform"></a>
      <a accesskey="b"
         href="http://www.py.cz/Shelve/backlinks"></a>
      <a accesskey="d" href="http://www.py.cz/Shelve/diff"></a>
      <a accesskey="y"
         href="http://www.py.cz/Shelve/history"></a>
      <a accesskey="e"
         href="http://www.py.cz/Shelve/editform"></a>
      
    </div>
      <div id="navlinks" class="linkpanel">
      <table class="shade1" width="100%" border="0" cellspacing="0">
        <tr>
          <td align="right">
            
      <a href="http://www.py.cz/FrontPage"
         title="show front page">
      <span>home</span></a>
      <a href="http://www.py.cz/FrontPage/contents#Shelve"
         title="show wiki contents">
      <span>contents</span></a>
      <a href="http://www.py.cz/FrontPage/recentchanges"
         title="show wiki recent changes">
      <span>changes</span></a>
      
      <a title="show wiki index"
         href="http://www.py.cz/FrontPage/wikiindex">
      <span>index</span></a>
      
      <a title="show wiki options"
         href="http://www.py.cz/FrontPage/useroptions?redirectURL=http%3A//www.py.cz/Shelve">
      <span>options</span></a>
      <a title="show help page"
         href="http://www.py.cz/HelpPage">
      <span>help</span></a>
    
            
      
      <a href="http://www.py.cz/Shelve/subscribeform"
         title="configure email subscription to this page or site">
        
      <span>subscribe</span></a>
      
      <a href="http://www.py.cz/Shelve/editform"
         title="edit-page (last edited 7 years ago by blujacker)">
      <span>edit</span></a>
      
    
          </td>
        </tr>
      </table>
    </div>
      <div id="pageheader">
        <form method="GET"
              action="http://www.py.cz/FrontPage/searchwiki">
          <table width="100%" border="0" cellspacing="0">
            <tr>
              <!-- logo -->
              <td id="logo" width="1%" valign="top"
                  class="logo">
                
                  <a title="go to home page"
                     href="http://www.py.cz/FrontPage">
                    
                    <img src="http://www.py.cz/Shelve/logo.jpg" border="0" alt="home" />
                    
                  </a>
                  &nbsp;
                
              </td>
              <!-- page name and context (parent topics) -->
              <td align="left" width="79%">
                
                  <small><ul class="outline expandable">
 <li><h1 style="display:inline;"><a href="http://www.py.cz/Shelve/backlinks" title="which pages link to this one ?" name="Shelve">Shelve</a></h1> ...
 </li>
</ul>
</small>
                
                
              </td>
              <!-- search form & page info -->
              <td class="searchbox" width="20%" align="right">
                
                  <input id="searchinput" class="formfield"
                         name="expr" type="text" size="20"
                         maxlength="100" value=""
                         title="search all pages" /><br />
                  <span class="lasteditor">last edited  <a href="http://www.py.cz/Shelve/history" title="show last edit" >7 years</a> ago by <b>blujacker</b></span><br>
                  <span class="creator">created 2008-05-28</span>   
                
                
              </td>
            </tr>
          </table>
        </form>
      </div>
      <div id="ratingform" align="right">  
      <!-- page rating form -->
      <div>
        <a name="ratingform"></a>
        <style type="text/css">
          input.rating {border:none;}
        </style>
        <form method="POST" id="ratingform"
              action="http://www.py.cz/Shelve/vote">
           <input type="image" name="vote0" value="0"
                  alt="0" class="rating" width="14"
                  height="13"
                  src="http://www.py.cz/p_/sp"
                  style=""
                  title="click to vote 0 (poor) for this page (0 votes)" /><input
    type="image" name="vote1" value="1" alt="1"
    class="rating" src="http://www.py.cz/Shelve/misc_/ZWiki/star_icon" style=""
    title="click to vote 1 (average) for this page (0 votes)" /><input
    type="image" name="vote2" value="2" alt="2"
    class="rating" src="http://www.py.cz/Shelve/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 2 (above average) for this page (0 votes)" /><input
    type="image" name="vote3" value="3" alt="3"
    class="rating" src="http://www.py.cz/Shelve/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 3 (good) for this page (0 votes)" /><input
    type="image" name="vote4" value="4" alt="4"
    class="rating" src="http://www.py.cz/Shelve/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 4 (great) for this page (0 votes)" /><input
    type="image" name="vote5" value="5" alt="5"
    class="rating" src="http://www.py.cz/Shelve/misc_/ZWiki/blank_star_icon"
    style=""
    title="click to vote 5 (superb) for this page (0 votes)" />
        </form>
      </div>
    </div>
    </div>
      <h1>Edit detail for Shelve revision 1 of 1</h1>
      <div class="formcontent">
        <table border="0" cellspacing="0" width="100%">
          <tr valign="top">

            <td align="left">
              <form style="display:inline"
                    action="http://www.py.cz/Shelve">
                <input type="submit" name="history:method"
                       value="Return to edit history" />
                
              </form>
            </td>

            <td align="center">
              <form style="display:inline"
                    action="http://www.py.cz/Shelve/diff">
                <input type="hidden" name="rev" />
                
                <input disabled="1" value=" &lt; "
                       type="submit" accesskey="," />
              </form>
              <a style="font-weight:bold"
                 href="http://www.py.cz/Shelve/diff?rev=1">1</a>
              <form style="display:inline"
                    action="http://www.py.cz/Shelve/diff">
                <input type="hidden" name="rev" />
                
                <input disabled="1" value=" &gt; "
                       type="submit" accesskey="." />
              </form>
            </td>

            <td align="right">
              <form style="display:inline"
                    action="http://www.py.cz/Shelve">
                <input type="hidden" name="rev" value="1" />
                <input value="Revert to this version"
                       type="submit" name="revert:method"
                       disabled="disabled" />
              </form>
            </td>

          </tr>
          <tr valign="top">
            <td colspan="3">
              <span>Editor:</span> blujacker
              <br />
              <span>Time:</span> 2008/05/28 14:42:48 GMT+2
            </td>
          </tr>
          <tr valign="top">
            <td colspan="3">
              <span>Note:</span> <span
    style="font-weight:bold; font-style:italic;"></span>
            </td>
          </tr>
        </table>
        <hr />
        <pre>
<b>changed:</b><span style="color:red;text-decoration:line-through">
-</span><span style="color:green">
&lt;h2&gt;Modul shelve&lt;/h2&gt;
&lt;p&gt;Soubory vytvořené modulem &lt;code&gt;shelve&lt;/code&gt; se chovají jako slovníky. Modul dokáže uložit a přečíst nějakou jejich hodnotu aniž by musel načítat ostatní data. Možná si říkáte, že stejného efektu lze dosáhnout i pomocí modulu &lt;code&gt;pickle&lt;/code&gt;, ale není to tak. Pokud totiž uložíte pomocí modulu &lt;code&gt;pickle&lt;/code&gt; nějaký slovník, a pak z něj chcete získat nějaké údaje, musíte ho nejdřív celý načíst. Oproti tomu modul &lt;code&gt;shelve&lt;/code&gt;, dokáže vytáhnout jakoukoliv hodnotu a nemusí při tom načítat zbytek dat. Proto se tento modul hodí právě na zpracování velkého množství dat. Dalo by se tedy říci, že se tento modul dá použít jako primitivní databáze.&lt;/p&gt;
&lt;p&gt;Jak je vám jistě známo, slovník se v podstatě skládá z dvou věcí: klíč → hodnota (&lt;code&gt;key → value&lt;/code&gt;). Když ukládáme nějaké věci pomocí modulu &lt;code&gt;shelve&lt;/code&gt;, klíč musí být vždy řetězec, ale hodnota může nabývat typu čísla, slovníku, seznamu, ... (vše, s čím si poradí modul &lt;code&gt;pickle&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Databáze se otevírá pomocí funkce &lt;code&gt;db = shelve.open(jmeno)&lt;/code&gt;. Pokud taková databáze neexistuje, bude vytvořena. Pak s vráceným objektem můžeme pracovat jako se slovníkem. Po dokončení čtení/zápisu dat je třeba databázi uzavřít pomocí metody &lt;code&gt;db.close()&lt;/code&gt;.&lt;/p&gt;
&lt;pre class = 'code'&gt;
import shelve
db = shelve.open(&quot;db.txt&quot;)
db[&quot;jedna&quot;] = 1
db.close()
&lt;/pre&gt;
&lt;p&gt;Vytvořili jsme databázi jménem &lt;code&gt;db.txt&lt;/code&gt;. Proměnná &lt;code&gt;db&lt;/code&gt; se chová stejně jako slovník, tj. má i stejné metody:&lt;/p&gt;
&lt;pre class = 'code'&gt;
print db.keys()
print db.has_key(&quot;jedna&quot;)
print db.items()
&lt;/pre&gt;
&lt;p&gt;Mazání z databáze může probíhat pomocí dvou způsobů:&lt;/p&gt;
&lt;pre class = 'code'&gt;
import shelve
db = shelve.open(&quot;db.txt&quot;)
db[&quot;jedna&quot;] = 1
db[&quot;dva&quot;] = 2
del db[&quot;jedna&quot;]
db.pop(&quot;dva&quot;)
print db.keys()
db.close()
&lt;/pre&gt;
&lt;p&gt;Nyní se dá říci, že už umíte pracovat s modulem &lt;code&gt;shelve&lt;/code&gt;, ale přesto je zde ještě jedna věc, která stojí za zmínku.&lt;/p&gt;
&lt;h3&gt;writeback&lt;/h3&gt;
&lt;p&gt;Při otevírání databáze se dá nastavit parametr &lt;code&gt;writeback&lt;/code&gt;. Pomocí toho parametru se určuje, jak bude databáze nakládat se změnami provedenými za chodu.&lt;/p&gt;
&lt;pre class = 'code'&gt;
#standardně se databáze otevírá s writeback = False
import shelve
db = shelve.open(&quot;db.txt&quot;)
db[&quot;seznam&quot;] = []
db[&quot;seznam&quot;].append(1)
db[&quot;seznam&quot;].append(2)
print db[&quot;seznam&quot;]
db.close()
&lt;/pre&gt;
&lt;p&gt;Řádek &lt;code&gt;print db[&quot;seznam&quot;]&lt;/code&gt; vrátil prázdný seznam. Jak je to ale možné, když jsme do toho seznamu předtím uložili dvě hodnoty? Abychom do &lt;code&gt;db[&quot;seznam&quot;]&lt;/code&gt; mohli vložit nějaké hodnoty, musíme použít následující řešení:&lt;/p&gt;
&lt;pre class = 'code'&gt;
import shelve
db = shelve.open(&quot;db.txt&quot;)
db[&quot;seznam&quot;] = []
kopie = db[&quot;seznam&quot;]
kopie.append(1)
kopie.append(2)
db[&quot;seznam&quot;] = kopie
print db[&quot;seznam&quot;]
db.close()
&lt;/pre&gt;
&lt;p&gt;Pokud bychom nastavili &lt;code&gt;writeback&lt;/code&gt; na &lt;code&gt;True&lt;/code&gt;, fungovala by správně i první ukázka. Nicméně takto otevřená databáze je pomalejší a obecně se doporučuje nastavit &lt;code&gt;writeback&lt;/code&gt; na &lt;code&gt;False&lt;/code&gt;.&lt;/p&gt;
&lt;pre class = 'code'&gt;
import shelve
db = shelve.open(&quot;db.txt&quot;, writeback = True)
db[&quot;seznam&quot;] = []
db[&quot;seznam&quot;].append(1)
db[&quot;seznam&quot;].append(2)
print db[&quot;seznam&quot;]
db.close()
&lt;/pre&gt;
&lt;p&gt;Pro modul &lt;code&gt;shelve&lt;/code&gt; platí stejné podmínky co se ukládání týče jako pro modul &lt;code&gt;pickle&lt;/code&gt;. Nepodaří se vám tedy uložit například instanci &lt;code&gt;Tk()&lt;/code&gt;:&lt;/p&gt;
&lt;pre class = 'code'&gt;
Traceback (most recent call last):
  File &quot;C:\DOCUME~1\BLUJAC~1\LOCALS~1\Temp\A7563708.py&quot;, line 4, in &lt;module&gt;
    db[&quot;Tk&quot;] = Tk()
  File &quot;C:\Python25\lib\shelve.py&quot;, line 123, in __setitem__
    p.dump(value)
cPickle.UnpickleableError: Cannot pickle &lt;type tkapp=&quot;&quot;&gt; objects
&lt;/type&gt;&lt;/module&gt;
&lt;/pre&gt;</span>
</pre>
        <hr />
        <div><h2>Modul shelve</h2>
<p>Soubory vytvořené modulem <code>shelve</code> se chovají jako slovníky. Modul dokáže uložit a přečíst nějakou jejich hodnotu aniž by musel načítat ostatní data. Možná si říkáte, že stejného efektu lze dosáhnout i pomocí modulu <code>pickle</code>, ale není to tak. Pokud totiž uložíte pomocí modulu <code>pickle</code> nějaký slovník, a pak z něj chcete získat nějaké údaje, musíte ho nejdřív celý načíst. Oproti tomu modul <code>shelve</code>, dokáže vytáhnout jakoukoliv hodnotu a nemusí při tom načítat zbytek dat. Proto se tento modul hodí právě na zpracování velkého množství dat. Dalo by se tedy říci, že se tento modul dá použít jako primitivní databáze.</p>
<p>Jak je vám jistě známo, slovník se v podstatě skládá z dvou věcí: klíč → hodnota (<code>key → value</code>). Když ukládáme nějaké věci pomocí modulu <code>shelve</code>, klíč musí být vždy řetězec, ale hodnota může nabývat typu čísla, slovníku, seznamu, ... (vše, s čím si poradí modul <code>pickle</code>).</p>
<p>Databáze se otevírá pomocí funkce <code>db = shelve.open(jmeno)</code>. Pokud taková databáze neexistuje, bude vytvořena. Pak s vráceným objektem můžeme pracovat jako se slovníkem. Po dokončení čtení/zápisu dat je třeba databázi uzavřít pomocí metody <code>db.close()</code>.</p>
<pre class = 'code'>
import shelve
db = shelve.open("db.txt")
db["jedna"] = 1
db.close()
</pre>
<p>Vytvořili jsme databázi jménem <code>db.txt</code>. Proměnná <code>db</code> se chová stejně jako slovník, tj. má i stejné metody:</p>
<pre class = 'code'>
print db.keys()
print db.has_key("jedna")
print db.items()
</pre>
<p>Mazání z databáze může probíhat pomocí dvou způsobů:</p>
<pre class = 'code'>
import shelve
db = shelve.open("db.txt")
db["jedna"] = 1
db["dva"] = 2
del db["jedna"]
db.pop("dva")
print db.keys()
db.close()
</pre>
<p>Nyní se dá říci, že už umíte pracovat s modulem <code>shelve</code>, ale přesto je zde ještě jedna věc, která stojí za zmínku.</p>
<h3>writeback</h3>
<p>Při otevírání databáze se dá nastavit parametr <code>writeback</code>. Pomocí toho parametru se určuje, jak bude databáze nakládat se změnami provedenými za chodu.</p>
<pre class = 'code'>
#standardně se databáze otevírá s writeback = False
import shelve
db = shelve.open("db.txt")
db["seznam"] = []
db["seznam"].append(1)
db["seznam"].append(2)
print db["seznam"]
db.close()
</pre>
<p>Řádek <code>print db["seznam"]</code> vrátil prázdný seznam. Jak je to ale možné, když jsme do toho seznamu předtím uložili dvě hodnoty? Abychom do <code>db["seznam"]</code> mohli vložit nějaké hodnoty, musíme použít následující řešení:</p>
<pre class = 'code'>
import shelve
db = shelve.open("db.txt")
db["seznam"] = []
kopie = db["seznam"]
kopie.append(1)
kopie.append(2)
db["seznam"] = kopie
print db["seznam"]
db.close()
</pre>
<p>Pokud bychom nastavili <code>writeback</code> na <code>True</code>, fungovala by správně i první ukázka. Nicméně takto otevřená databáze je pomalejší a obecně se doporučuje nastavit <code>writeback</code> na <code>False</code>.</p>
<pre class = 'code'>
import shelve
db = shelve.open("db.txt", writeback = True)
db["seznam"] = []
db["seznam"].append(1)
db["seznam"].append(2)
print db["seznam"]
db.close()
</pre>
<p>Pro modul <code>shelve</code> platí stejné podmínky co se ukládání týče jako pro modul <code>pickle</code>. Nepodaří se vám tedy uložit například instanci <code>Tk()</code>:</p>
<pre class = 'code'>
Traceback (most recent call last):
  File "C:\DOCUME~1\BLUJAC~1\LOCALS~1\Temp\A7563708.py", line 4, in <module>
    db["Tk"] = Tk()
  File "C:\Python25\lib\shelve.py", line 123, in __setitem__
    p.dump(value)
cPickle.UnpickleableError: Cannot pickle <type tkapp=""> objects
</type></module>
</pre>

</div>
      </div>
    </div>
    
  </body>

<!-- Mirrored from www.py.cz/Shelve/diff by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Mar 2016 21:15:54 GMT -->
</html>

